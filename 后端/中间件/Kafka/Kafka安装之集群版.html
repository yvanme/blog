<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka安装（集群版）</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.fb1232a2.js" as="script"><link rel="preload" href="/assets/js/2.7b8aa595.js" as="script"><link rel="preload" href="/assets/js/21.feab52c3.js" as="script"><link rel="prefetch" href="/assets/js/10.3956e9c0.js"><link rel="prefetch" href="/assets/js/100.45907d98.js"><link rel="prefetch" href="/assets/js/101.a1979b5a.js"><link rel="prefetch" href="/assets/js/102.ad62e1ec.js"><link rel="prefetch" href="/assets/js/103.5bc4f2e3.js"><link rel="prefetch" href="/assets/js/104.f0c1d426.js"><link rel="prefetch" href="/assets/js/105.b8acab66.js"><link rel="prefetch" href="/assets/js/106.63abceda.js"><link rel="prefetch" href="/assets/js/107.040f8404.js"><link rel="prefetch" href="/assets/js/108.ce6e7445.js"><link rel="prefetch" href="/assets/js/109.838e9810.js"><link rel="prefetch" href="/assets/js/11.32a5c154.js"><link rel="prefetch" href="/assets/js/110.c4916867.js"><link rel="prefetch" href="/assets/js/111.4ef4ce76.js"><link rel="prefetch" href="/assets/js/112.fc879400.js"><link rel="prefetch" href="/assets/js/113.6d34c3c8.js"><link rel="prefetch" href="/assets/js/114.41fd81aa.js"><link rel="prefetch" href="/assets/js/115.230b4582.js"><link rel="prefetch" href="/assets/js/116.cf904c82.js"><link rel="prefetch" href="/assets/js/117.0bd414ac.js"><link rel="prefetch" href="/assets/js/118.1f2e5268.js"><link rel="prefetch" href="/assets/js/119.93ce1fca.js"><link rel="prefetch" href="/assets/js/12.de3d20c3.js"><link rel="prefetch" href="/assets/js/120.1a20598b.js"><link rel="prefetch" href="/assets/js/121.4a71ce3e.js"><link rel="prefetch" href="/assets/js/122.cc0e457c.js"><link rel="prefetch" href="/assets/js/123.3291326b.js"><link rel="prefetch" href="/assets/js/124.daaeeaf2.js"><link rel="prefetch" href="/assets/js/125.b9c4c654.js"><link rel="prefetch" href="/assets/js/126.d45e23a4.js"><link rel="prefetch" href="/assets/js/127.6f8ed00e.js"><link rel="prefetch" href="/assets/js/128.6269e16a.js"><link rel="prefetch" href="/assets/js/129.ad542cd9.js"><link rel="prefetch" href="/assets/js/13.3b9575bd.js"><link rel="prefetch" href="/assets/js/130.13b86e9c.js"><link rel="prefetch" href="/assets/js/131.3d619705.js"><link rel="prefetch" href="/assets/js/132.db852035.js"><link rel="prefetch" href="/assets/js/133.50e8050a.js"><link rel="prefetch" href="/assets/js/134.6c853199.js"><link rel="prefetch" href="/assets/js/135.5199a333.js"><link rel="prefetch" href="/assets/js/136.a7ea5608.js"><link rel="prefetch" href="/assets/js/137.65a7ac46.js"><link rel="prefetch" href="/assets/js/138.b42f2c59.js"><link rel="prefetch" href="/assets/js/139.dd423465.js"><link rel="prefetch" href="/assets/js/14.93d9a772.js"><link rel="prefetch" href="/assets/js/140.3f4b5066.js"><link rel="prefetch" href="/assets/js/141.123781cc.js"><link rel="prefetch" href="/assets/js/142.dd95d97e.js"><link rel="prefetch" href="/assets/js/143.fdd9587d.js"><link rel="prefetch" href="/assets/js/144.09e19455.js"><link rel="prefetch" href="/assets/js/145.f3d181fe.js"><link rel="prefetch" href="/assets/js/146.d2b11381.js"><link rel="prefetch" href="/assets/js/147.f7616895.js"><link rel="prefetch" href="/assets/js/148.7e86887d.js"><link rel="prefetch" href="/assets/js/149.1a39fccd.js"><link rel="prefetch" href="/assets/js/15.148492d0.js"><link rel="prefetch" href="/assets/js/150.b93bc087.js"><link rel="prefetch" href="/assets/js/151.ba3d0503.js"><link rel="prefetch" href="/assets/js/152.82e9f2f9.js"><link rel="prefetch" href="/assets/js/153.251ab7b1.js"><link rel="prefetch" href="/assets/js/154.c500794f.js"><link rel="prefetch" href="/assets/js/155.53f7b163.js"><link rel="prefetch" href="/assets/js/156.d1cd35c4.js"><link rel="prefetch" href="/assets/js/157.2edb721e.js"><link rel="prefetch" href="/assets/js/158.7e65c935.js"><link rel="prefetch" href="/assets/js/159.c37b9c3e.js"><link rel="prefetch" href="/assets/js/16.00c9741a.js"><link rel="prefetch" href="/assets/js/160.4c05d797.js"><link rel="prefetch" href="/assets/js/161.79955dc4.js"><link rel="prefetch" href="/assets/js/162.8d334156.js"><link rel="prefetch" href="/assets/js/163.599fae50.js"><link rel="prefetch" href="/assets/js/164.686f71b9.js"><link rel="prefetch" href="/assets/js/165.b8a2d10e.js"><link rel="prefetch" href="/assets/js/166.1c4547c2.js"><link rel="prefetch" href="/assets/js/167.7cdb8a0b.js"><link rel="prefetch" href="/assets/js/168.a32aaaf5.js"><link rel="prefetch" href="/assets/js/169.63d00475.js"><link rel="prefetch" href="/assets/js/17.620c1837.js"><link rel="prefetch" href="/assets/js/170.36c1e757.js"><link rel="prefetch" href="/assets/js/171.45f1ab8c.js"><link rel="prefetch" href="/assets/js/172.66de6c52.js"><link rel="prefetch" href="/assets/js/173.cbf880ca.js"><link rel="prefetch" href="/assets/js/174.2401f327.js"><link rel="prefetch" href="/assets/js/175.064fc180.js"><link rel="prefetch" href="/assets/js/176.d18d0ca2.js"><link rel="prefetch" href="/assets/js/177.7b006416.js"><link rel="prefetch" href="/assets/js/178.74c264b7.js"><link rel="prefetch" href="/assets/js/179.1308e968.js"><link rel="prefetch" href="/assets/js/18.3cd79d74.js"><link rel="prefetch" href="/assets/js/180.5ff7154e.js"><link rel="prefetch" href="/assets/js/181.0f518132.js"><link rel="prefetch" href="/assets/js/19.06908f6b.js"><link rel="prefetch" href="/assets/js/20.61b51eb5.js"><link rel="prefetch" href="/assets/js/22.3a158ad1.js"><link rel="prefetch" href="/assets/js/23.9d5a5381.js"><link rel="prefetch" href="/assets/js/24.6aee6956.js"><link rel="prefetch" href="/assets/js/25.379fdda3.js"><link rel="prefetch" href="/assets/js/26.a0dc095e.js"><link rel="prefetch" href="/assets/js/27.b7eac53d.js"><link rel="prefetch" href="/assets/js/28.9407dd73.js"><link rel="prefetch" href="/assets/js/29.0bce04d8.js"><link rel="prefetch" href="/assets/js/3.9bab7b5b.js"><link rel="prefetch" href="/assets/js/30.491721cd.js"><link rel="prefetch" href="/assets/js/31.97769a88.js"><link rel="prefetch" href="/assets/js/32.bbac853a.js"><link rel="prefetch" href="/assets/js/33.0a598568.js"><link rel="prefetch" href="/assets/js/34.7b0bd00e.js"><link rel="prefetch" href="/assets/js/35.77c6e609.js"><link rel="prefetch" href="/assets/js/36.6a089f7c.js"><link rel="prefetch" href="/assets/js/37.be5e5cee.js"><link rel="prefetch" href="/assets/js/38.17772da1.js"><link rel="prefetch" href="/assets/js/39.7967c09f.js"><link rel="prefetch" href="/assets/js/4.ba3164ba.js"><link rel="prefetch" href="/assets/js/40.0be77dd9.js"><link rel="prefetch" href="/assets/js/41.44eec76e.js"><link rel="prefetch" href="/assets/js/42.a31a2f83.js"><link rel="prefetch" href="/assets/js/43.10bbf2e5.js"><link rel="prefetch" href="/assets/js/44.866c8b9f.js"><link rel="prefetch" href="/assets/js/45.8838049f.js"><link rel="prefetch" href="/assets/js/46.17135848.js"><link rel="prefetch" href="/assets/js/47.eebc0603.js"><link rel="prefetch" href="/assets/js/48.d4621e71.js"><link rel="prefetch" href="/assets/js/49.7561c10b.js"><link rel="prefetch" href="/assets/js/5.75a3592b.js"><link rel="prefetch" href="/assets/js/50.abe160b3.js"><link rel="prefetch" href="/assets/js/51.ea0f774b.js"><link rel="prefetch" href="/assets/js/52.39574502.js"><link rel="prefetch" href="/assets/js/53.cc357b92.js"><link rel="prefetch" href="/assets/js/54.f00e3ef9.js"><link rel="prefetch" href="/assets/js/55.1daf4eac.js"><link rel="prefetch" href="/assets/js/56.6d3f3023.js"><link rel="prefetch" href="/assets/js/57.2ded9a0a.js"><link rel="prefetch" href="/assets/js/58.0c6af46a.js"><link rel="prefetch" href="/assets/js/59.54f2a062.js"><link rel="prefetch" href="/assets/js/6.0377ba0c.js"><link rel="prefetch" href="/assets/js/60.97fd32e4.js"><link rel="prefetch" href="/assets/js/61.e98e89ef.js"><link rel="prefetch" href="/assets/js/62.e3e3b8fe.js"><link rel="prefetch" href="/assets/js/63.0c8bb4c3.js"><link rel="prefetch" href="/assets/js/64.7105ef89.js"><link rel="prefetch" href="/assets/js/65.cf181aa0.js"><link rel="prefetch" href="/assets/js/66.5da64f7b.js"><link rel="prefetch" href="/assets/js/67.44e3ae6e.js"><link rel="prefetch" href="/assets/js/68.8392d4df.js"><link rel="prefetch" href="/assets/js/69.5c27b612.js"><link rel="prefetch" href="/assets/js/7.b533326e.js"><link rel="prefetch" href="/assets/js/70.0d315182.js"><link rel="prefetch" href="/assets/js/71.d9bd06ce.js"><link rel="prefetch" href="/assets/js/72.81b096f4.js"><link rel="prefetch" href="/assets/js/73.f99580df.js"><link rel="prefetch" href="/assets/js/74.11be9ffd.js"><link rel="prefetch" href="/assets/js/75.31a13e5b.js"><link rel="prefetch" href="/assets/js/76.1cad8b67.js"><link rel="prefetch" href="/assets/js/77.95931e9e.js"><link rel="prefetch" href="/assets/js/78.9b76df26.js"><link rel="prefetch" href="/assets/js/79.ddd62d67.js"><link rel="prefetch" href="/assets/js/8.adc8009a.js"><link rel="prefetch" href="/assets/js/80.617e3440.js"><link rel="prefetch" href="/assets/js/81.557a7211.js"><link rel="prefetch" href="/assets/js/82.7f622558.js"><link rel="prefetch" href="/assets/js/83.94b176c9.js"><link rel="prefetch" href="/assets/js/84.79ed3c3b.js"><link rel="prefetch" href="/assets/js/85.46b0b367.js"><link rel="prefetch" href="/assets/js/86.dc0cc4b8.js"><link rel="prefetch" href="/assets/js/87.102663c7.js"><link rel="prefetch" href="/assets/js/88.8152456c.js"><link rel="prefetch" href="/assets/js/89.a132daa9.js"><link rel="prefetch" href="/assets/js/9.01942828.js"><link rel="prefetch" href="/assets/js/90.d320e71a.js"><link rel="prefetch" href="/assets/js/91.02446897.js"><link rel="prefetch" href="/assets/js/92.187a4d7c.js"><link rel="prefetch" href="/assets/js/93.6fb76df5.js"><link rel="prefetch" href="/assets/js/94.b84d2ff0.js"><link rel="prefetch" href="/assets/js/95.147b7ce5.js"><link rel="prefetch" href="/assets/js/96.d2054dbf.js"><link rel="prefetch" href="/assets/js/97.8147f97a.js"><link rel="prefetch" href="/assets/js/98.c6b18cd9.js"><link rel="prefetch" href="/assets/js/99.09bf6d3d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kafka安装-集群版"><a href="#kafka安装-集群版" class="header-anchor">#</a> Kafka安装（集群版）</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>[TOC]</p> <p><strong>环境：CentOS7、kafka_2.12-2.3.0版本</strong></p> <p><strong>主机配置:</strong></p> <table><thead><tr><th>主机名</th> <th>IP地址</th> <th>JDK</th> <th>Hadoop</th></tr></thead> <tbody><tr><td>master</td> <td>192.168.153.130</td> <td>1.8.0_201</td> <td>server.1</td></tr> <tr><td>slave1</td> <td>192.168.153.131</td> <td>1.8.0_201</td> <td>server.2</td></tr> <tr><td>slave2</td> <td>192.168.153.132</td> <td>1.8.0_201</td> <td>server.3</td></tr></tbody></table> <p><strong>安装目录：/apps/kafka_2.12-2.3.0</strong></p> <p><strong>备注：kafka依赖zookeeper，因此在安装kafka之前需要安装好zookeeper环境</strong></p> <p>​      <strong>1.集群安装规划</strong></p> <p>​      <strong>1.1</strong> <strong>软件规划</strong></p> <table><thead><tr><th>软件</th> <th>版本</th></tr></thead> <tbody><tr><td>Jdk</td> <td>Jdk1.8</td></tr> <tr><td>CentOS</td> <td>CentOS7</td></tr> <tr><td>Zookeeper</td> <td>Zookeeper3.4.14</td></tr> <tr><td>kafka</td> <td>kafka_2.12-2.3.0</td></tr></tbody></table> <p><strong>1.2数据目录规划</strong></p> <p>​      在搭建Hadoop集群之前，需要规划好所有的软件目录和数据存放目录，便于后期的管理与维护。</p> <table><thead><tr><th>目录名称</th> <th>绝对路径</th></tr></thead> <tbody><tr><td>所有软件存放目录</td> <td>/apps/app</td></tr> <tr><td>所有数据与日志存放目录</td> <td>/apps/data</td></tr></tbody></table> <p>​	<strong>2. 集群安装</strong></p> <ul><li><strong>配置主机名（永久修改主机名）</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>hostnamectl --static set-hostname &lt;host-name&gt;
</code></pre></div><ul><li><strong>修改/etc/hosts,加入以下配置，使节点之间可以通过主机名访问</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>192.168.153.130 master
192.168.153.131 slave1
192.168.153.132 slave2
</code></pre></div><ul><li><p><strong>关闭防火墙</strong></p> <p>查看防火墙状态</p> <div class="language- extra-class"><pre class="language-text"><code>systemctl status firewalld 
</code></pre></div><p>临时关闭防火墙</p> <div class="language- extra-class"><pre class="language-text"><code>systemctl stop firewalld
</code></pre></div><p>永久关闭防火墙(需要重启才能生效)</p> <div class="language- extra-class"><pre class="language-text"><code>systemctl disable firewalld
</code></pre></div></li> <li><p><strong>关闭selinux</strong>
selinux是Linux一个子安全机制，学习环境可以将它禁用</p> <div class="language- extra-class"><pre class="language-text"><code>vim /etc/sysconfig/selinux
</code></pre></div><p>把SELINUX设置成disabled</p> <div class="language- extra-class"><pre class="language-text"><code>SELINUX=disabled
</code></pre></div></li> <li><p><strong>设置节点间免密登陆</strong></p> <ul><li><p>在jmaster上生成公钥私钥</p> <div class="language-shell extra-class"><pre class="language-shell"><code>ssh-keygen
</code></pre></div></li> <li><p>查看公钥私钥</p> <div class="language-shell extra-class"><pre class="language-shell"><code>ll -a
</code></pre></div></li> <li><p>将公钥拷贝到slave1,slave2节点</p> <div class="language-shell extra-class"><pre class="language-shell"><code>ssh-copy-id root@slave1
ssh-copy-id root@slave2
</code></pre></div></li> <li><p>其他两台机器重复此步骤</p></li> <li><p>在slave1上免密登陆slave2</p> <div class="language-shell extra-class"><pre class="language-shell"><code> <span class="token function">ssh</span> root@slave2
</code></pre></div></li></ul></li> <li><p><strong>配置脚本工具</strong></p> <ul><li><p>deploy.conf</p> <div class="language- extra-class"><pre class="language-text"><code>#规划集群角色
master,all,namenode,zookeeper,resourcemanager,
slave1,all,slave,namenode,zookeeper,resourcemanager,
slave2,all,slave,datanode,zookeeper,
</code></pre></div></li> <li><p>deploy.sh</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#set -x</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> -lt <span class="token number">3</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span> 
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Usage: ./deply.sh srcFile(or Dir) descFile(or Dir) MachineTag&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Usage: ./deply.sh srcFile(or Dir) descFile(or Dir) MachineTag confFile&quot;</span>
  <span class="token builtin class-name">exit</span> 
<span class="token keyword">fi</span>

<span class="token assign-left variable">src</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">dest</span><span class="token operator">=</span><span class="token variable">$2</span>
<span class="token assign-left variable">tag</span><span class="token operator">=</span><span class="token variable">$3</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token variable">$4</span><span class="token string">'a'</span> <span class="token operator">==</span> <span class="token string">'aa'</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
  <span class="token assign-left variable">confFile</span><span class="token operator">=</span>/apps/deploy.conf
<span class="token keyword">else</span> 
  <span class="token assign-left variable">confFile</span><span class="token operator">=</span><span class="token variable">$4</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token variable">$confFile</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token variable">$src</span> <span class="token punctuation">]</span>
  <span class="token keyword">then</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">server</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $confFile<span class="token operator">|</span><span class="token function">grep</span> -v <span class="token string">'^#'</span><span class="token operator">|</span><span class="token function">grep</span> <span class="token string">','</span>$tag<span class="token string">','</span><span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">','</span> <span class="token string">'{print $1}'</span><span class="token variable">`</span></span> 
    <span class="token keyword">do</span>
       <span class="token function">scp</span> <span class="token variable">$src</span> <span class="token variable">$server</span><span class="token string">&quot;:&quot;</span><span class="token variable">${dest}</span>
    <span class="token keyword">done</span> 
  <span class="token keyword">elif</span> <span class="token punctuation">[</span> -d <span class="token variable">$src</span> <span class="token punctuation">]</span>
  <span class="token keyword">then</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">server</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $confFile<span class="token operator">|</span><span class="token function">grep</span> -v <span class="token string">'^#'</span><span class="token operator">|</span><span class="token function">grep</span> <span class="token string">','</span>$tag<span class="token string">','</span><span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">','</span> <span class="token string">'{print $1}'</span><span class="token variable">`</span></span> 
    <span class="token keyword">do</span>
       <span class="token function">scp</span> -r <span class="token variable">$src</span> <span class="token variable">$server</span><span class="token string">&quot;:&quot;</span><span class="token variable">${dest}</span>
    <span class="token keyword">done</span> 
  <span class="token keyword">else</span>
      <span class="token builtin class-name">echo</span> <span class="token string">&quot;Error: No source file exist&quot;</span>
  <span class="token keyword">fi</span>

<span class="token keyword">else</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Error: Please assign config file or run deploy.sh command with deploy.conf in same directory&quot;</span>
<span class="token keyword">fi</span>
</code></pre></div></li> <li><p>runRemoteCmd.sh</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment">#set -x</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> -lt <span class="token number">2</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span> 
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Usage: ./runRemoteCmd.sh Command MachineTag&quot;</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Usage: ./runRemoteCmd.sh Command MachineTag confFile&quot;</span>
  <span class="token builtin class-name">exit</span> 
<span class="token keyword">fi</span>

<span class="token assign-left variable">cmd</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">tag</span><span class="token operator">=</span><span class="token variable">$2</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token variable">$3</span><span class="token string">'a'</span> <span class="token operator">==</span> <span class="token string">'aa'</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
  
  <span class="token assign-left variable">confFile</span><span class="token operator">=</span>/apps/deploy.conf
<span class="token keyword">else</span> 
  <span class="token assign-left variable">confFile</span><span class="token operator">=</span><span class="token variable">$3</span>
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -f <span class="token variable">$confFile</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token keyword">for</span> <span class="token for-or-select variable">server</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> $confFile<span class="token operator">|</span><span class="token function">grep</span> -v <span class="token string">'^#'</span><span class="token operator">|</span><span class="token function">grep</span> <span class="token string">','</span>$tag<span class="token string">','</span><span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">','</span> <span class="token string">'{print $1}'</span><span class="token variable">`</span></span> 
    <span class="token keyword">do</span>
       <span class="token builtin class-name">echo</span> <span class="token string">&quot;*******************<span class="token variable">$server</span>***************************&quot;</span>
       <span class="token function">ssh</span> <span class="token variable">$server</span> <span class="token string">&quot;source /etc/profile; <span class="token variable">$cmd</span>&quot;</span>
    <span class="token keyword">done</span> 
<span class="token keyword">else</span>
  <span class="token builtin class-name">echo</span> <span class="token string">&quot;Error: Please assign config file or run deploy.sh command with deploy.conf in same directory&quot;</span>
<span class="token keyword">fi</span>
</code></pre></div></li> <li><p>给脚本添加执行权限</p> <div class="language- extra-class"><pre class="language-text"><code> chmod u+x deploy.sh
 chmod u+x runRemoteCmd.sh
</code></pre></div></li></ul></li> <li><p><strong>安装jdk1.8</strong></p> <ul><li><p>使用解压命令解压到当前目录。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">tar</span> zxvf jdk-8u221-linux-x64.tar.gz
</code></pre></div></li> <li><p>修改etc/profile，在文件结尾追加如下命令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#java environment</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/apps/jdk1.8.0_221
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar 
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin
</code></pre></div></li> <li><p>保存profile，使之生效</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">source</span> /etc/profile
</code></pre></div></li> <li><p>检验是否安装成功</p> <div class="language-shell extra-class"><pre class="language-shell"><code>java -version
</code></pre></div></li></ul></li> <li><p><strong>安装Zookeeper</strong></p> <ul><li><p>将下载的Zookeeper文件上传到CentOS系统中。</p></li> <li><p>解压文件</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>tar -zxvf zookeeper-3.4.14.tar.gz
</code></pre></div><ul><li><p>进入到conf目录</p> <div class="language- extra-class"><pre class="language-text"><code>cd zookeeper-3.4.14/conf
</code></pre></div></li> <li><p>将zoo_sample.cfg拷贝一份为zoo.cfg</p> <div class="language- extra-class"><pre class="language-text"><code>cp zoo_sample.cfg zoo.cfg
</code></pre></div></li> <li><p>修改zoo.cfg配置文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># The number of milliseconds of each tick</span>
<span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token comment"># The number of ticks that the initial </span>
<span class="token comment"># synchronization phase can take</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token comment"># The number of ticks that can pass between </span>
<span class="token comment"># sending a request and getting an acknowledgement</span>
<span class="token assign-left variable">syncLimit</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment"># the directory where the snapshot is stored.</span>
<span class="token comment"># do not use /tmp for storage, /tmp here is just </span>
<span class="token comment"># example sakes.</span>
<span class="token comment">#数据存放目录</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/tmp/zookeeper
<span class="token assign-left variable">dataLogDir</span><span class="token operator">=</span>/tmp/zookeeper/log
<span class="token comment"># the port at which the clients will connect</span>
<span class="token comment">#服务的端口号</span>
<span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>
<span class="token comment"># the maximum number of client connections.</span>
<span class="token comment"># increase this if you need to handle more clients</span>
<span class="token comment">#maxClientCnxns=60</span>
<span class="token comment">#</span>
<span class="token comment"># Be sure to read the maintenance section of the </span>
<span class="token comment"># administrator guide before turning on autopurge.</span>
<span class="token comment">#</span>
<span class="token comment"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span>
<span class="token comment">#</span>
<span class="token comment"># The number of snapshots to retain in dataDir</span>
<span class="token comment">#autopurge.snapRetainCount=3</span>
<span class="token comment"># Purge task interval in hours</span>
<span class="token comment"># Set to &quot;0&quot; to disable auto purge feature</span>
<span class="token comment">#autopurge.purgeInterval=1</span>
server.1<span class="token operator">=</span>master:2888:3888
server.2<span class="token operator">=</span>slave1:2888:3888
server.3<span class="token operator">=</span>slave2:2888:3888

</code></pre></div></li> <li><p>创建ServerID标识</p> <p>除了修改zoo.cfg配置文件外,zookeeper集群模式下还要配置一个myid文件,这个文件需要放在dataDir目录下。</p> <p>这个文件里面有一个数据就是A的值（该A就是zoo.cfg文件中server.A=B:C:D中的A）,在zoo.cfg文件中配置的dataDir路径中创建myid文件。值同时与zoo.cfg文件里面的server.1保持一致，如下</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#192.168.153.130</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;1&quot;</span> <span class="token operator">&gt;</span> /tmp/zookeeper/myid
<span class="token comment">#192.168.153.131</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;2&quot;</span> <span class="token operator">&gt;</span> /tmp/zookeeper/myid
<span class="token comment">#192.168.153.132</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;3&quot;</span> <span class="token operator">&gt;</span> /tmp/zookeeper/myid
</code></pre></div></li> <li><p>设置环境变量</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#修改/etc/profile文件</span>
<span class="token function">vi</span> /etc/profile
<span class="token comment">#加入以下配置</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ZOOKEEPER_INSTALL</span><span class="token operator">=</span>/apps/zookeeper-3.4.14
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ZOOKEEPER_INSTALL</span>/bin
<span class="token comment">#使配置生效</span>
<span class="token builtin class-name">source</span> /etc/profile
</code></pre></div></li> <li><p>使用runRemoteCmd.sh 脚本，启动所有节点上面的Zookeeper</p> <div class="language- extra-class"><pre class="language-text"><code>runRemoteCmd.sh &quot;/apps/zookeeper-3.4.14/bin/zkServer.sh start&quot; zookeeper
</code></pre></div></li> <li><p>查看所有Zookeeper节点状态</p> <div class="language- extra-class"><pre class="language-text"><code>runRemoteCmd.sh &quot;/apps/zookeeper-3.4.14/bin/zkServer.sh status&quot; zookeeper
</code></pre></div></li></ul></li> <li><p><strong>集群搭建</strong></p></li> <li><p>下载解压kafka_2.12-2.3.0</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>tar -zvxf kafka_2.12-2.3.0.tgz
</code></pre></div><ul><li><strong>配置server.properties</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="token comment"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="token comment"># this work for additional information regarding copyright ownership.</span>
<span class="token comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="token comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span>
<span class="token comment"># the License.  You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token comment"># see kafka.server.KafkaConfig for additional details and defaults</span>

<span class="token comment">############################# Server Basics #############################</span>

<span class="token comment"># The id of the broker. This must be set to a unique integer for each broker.</span>
broker.id<span class="token operator">=</span><span class="token number">0</span>

<span class="token comment">############################# Socket Server Settings #############################</span>

<span class="token comment"># The address the socket server listens on. It will get the value returned from </span>
<span class="token comment"># java.net.InetAddress.getCanonicalHostName() if not configured.</span>
<span class="token comment">#   FORMAT:</span>
<span class="token comment">#     listeners = listener_name://host_name:port</span>
<span class="token comment">#   EXAMPLE:</span>
<span class="token comment">#     listeners = PLAINTEXT://your.host.name:9092</span>
<span class="token comment">#listeners=PLAINTEXT://:9092</span>
<span class="token assign-left variable">listeners</span><span class="token operator">=</span>PLAINTEXT://master:9092

<span class="token comment"># Hostname and port the broker will advertise to producers and consumers. If not set, </span>
<span class="token comment"># it uses the value for &quot;listeners&quot; if configured.  Otherwise, it will use the value</span>
<span class="token comment"># returned from java.net.InetAddress.getCanonicalHostName().</span>
<span class="token comment">#advertised.listeners=PLAINTEXT://your.host.name:9092</span>

<span class="token comment"># Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details</span>
<span class="token comment">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span>

<span class="token comment"># The number of threads that the server uses for receiving requests from the network and sending responses to the network</span>
num.network.threads<span class="token operator">=</span><span class="token number">3</span>

<span class="token comment"># The number of threads that the server uses for processing requests, which may include disk I/O</span>
num.io.threads<span class="token operator">=</span><span class="token number">8</span>

<span class="token comment"># The send buffer (SO_SNDBUF) used by the socket server</span>
socket.send.buffer.bytes<span class="token operator">=</span><span class="token number">102400</span>

<span class="token comment"># The receive buffer (SO_RCVBUF) used by the socket server</span>
socket.receive.buffer.bytes<span class="token operator">=</span><span class="token number">102400</span>

<span class="token comment"># The maximum size of a request that the socket server will accept (protection against OOM)</span>
socket.request.max.bytes<span class="token operator">=</span><span class="token number">104857600</span>


<span class="token comment">############################# Log Basics #############################</span>

<span class="token comment"># A comma separated list of directories under which to store log files</span>
log.dirs<span class="token operator">=</span>/apps/kafka_2.12-2.3.0/kafka-logs

<span class="token comment"># The default number of log partitions per topic. More partitions allow greater</span>
<span class="token comment"># parallelism for consumption, but this will also result in more files across</span>
<span class="token comment"># the brokers.</span>
num.partitions<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.</span>
<span class="token comment"># This value is recommended to be increased for installations with data dirs located in RAID array.</span>
num.recovery.threads.per.data.dir<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">############################# Internal Topic Settings  #############################</span>
<span class="token comment"># The replication factor for the group metadata internal topics &quot;__consumer_offsets&quot; and &quot;__transaction_state&quot;</span>
<span class="token comment"># For anything other than development testing, a value greater than 1 is recommended for to ensure availability such as 3.</span>
offsets.topic.replication.factor<span class="token operator">=</span><span class="token number">1</span>
transaction.state.log.replication.factor<span class="token operator">=</span><span class="token number">1</span>
transaction.state.log.min.isr<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">############################# Log Flush Policy #############################</span>

<span class="token comment"># Messages are immediately written to the filesystem but by default we only fsync() to sync</span>
<span class="token comment"># the OS cache lazily. The following configurations control the flush of data to disk.</span>
<span class="token comment"># There are a few important trade-offs here:</span>
<span class="token comment">#    1. Durability: Unflushed data may be lost if you are not using replication.</span>
<span class="token comment">#    2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.</span>
<span class="token comment">#    3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.</span>
<span class="token comment"># The settings below allow one to configure the flush policy to flush data after a period of time or</span>
<span class="token comment"># every N messages (or both). This can be done globally and overridden on a per-topic basis.</span>

<span class="token comment"># The number of messages to accept before forcing a flush of data to disk</span>
<span class="token comment">#log.flush.interval.messages=10000</span>

<span class="token comment"># The maximum amount of time a message can sit in a log before we force a flush</span>
<span class="token comment">#log.flush.interval.ms=1000</span>

<span class="token comment">############################# Log Retention Policy #############################</span>

<span class="token comment"># The following configurations control the disposal of log segments. The policy can</span>
<span class="token comment"># be set to delete segments after a period of time, or after a given size has accumulated.</span>
<span class="token comment"># A segment will be deleted whenever *either* of these criteria are met. Deletion always happens</span>
<span class="token comment"># from the end of the log.</span>

<span class="token comment"># The minimum age of a log file to be eligible for deletion due to age</span>
log.retention.hours<span class="token operator">=</span><span class="token number">168</span>

<span class="token comment"># A size-based retention policy for logs. Segments are pruned from the log unless the remaining</span>
<span class="token comment"># segments drop below log.retention.bytes. Functions independently of log.retention.hours.</span>
<span class="token comment">#log.retention.bytes=1073741824</span>

<span class="token comment"># The maximum size of a log segment file. When this size is reached a new log segment will be created.</span>
log.segment.bytes<span class="token operator">=</span><span class="token number">1073741824</span>

<span class="token comment"># The interval at which log segments are checked to see if they can be deleted according</span>
<span class="token comment"># to the retention policies</span>
log.retention.check.interval.ms<span class="token operator">=</span><span class="token number">300000</span>

<span class="token comment">############################# Zookeeper #############################</span>

<span class="token comment"># Zookeeper connection string (see zookeeper docs for details).</span>
<span class="token comment"># This is a comma separated host:port pairs, each corresponding to a zk</span>
<span class="token comment"># server. e.g. &quot;127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002&quot;.</span>
<span class="token comment"># You can also append an optional chroot string to the urls to specify the</span>
<span class="token comment"># root directory for all kafka znodes.</span>
zookeeper.connect<span class="token operator">=</span>master:2181,slave1:2181,slave2:2181

<span class="token comment"># Timeout in ms for connecting to zookeeper</span>
zookeeper.connection.timeout.ms<span class="token operator">=</span><span class="token number">6000</span>


<span class="token comment">############################# Group Coordinator Settings #############################</span>

<span class="token comment"># The following configuration specifies the time, in milliseconds, that the GroupCoordinator will delay the initial consumer rebalance.</span>
<span class="token comment"># The rebalance will be further delayed by the value of group.initial.rebalance.delay.ms as new members join the group, up to a maximum of max.poll.interval.ms.</span>
<span class="token comment"># The default value for this is 3 seconds.</span>
<span class="token comment"># We override this to 0 here as it makes for a better out-of-the-box experience for development and testing.</span>
<span class="token comment"># However, in production environments the default value of 3 seconds is more suitable as this will help to avoid unnecessary, and potentially expensive, rebalances during application startup.</span>
group.initial.rebalance.delay.ms<span class="token operator">=</span><span class="token number">0</span>
</code></pre></div><ul><li><strong>将kafka安装包分发到其他节点</strong></li></ul> <div class="language- extra-class"><pre class="language-text"><code>deploy.sh /apps/kafka_2.12-2.3.0 /apps/ slave
</code></pre></div><ul><li><strong>配置hadoop3环境变量，并使用source /etc/profile 使之生效</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#java environment</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/apps/jdk1.8.0_221
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/jre/lib/rt.jar:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar 
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin

<span class="token builtin class-name">export</span> <span class="token assign-left variable">ZOOKEEPER_INSTALL</span><span class="token operator">=</span>/apps/zookeeper-3.4.14
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ZOOKEEPER_INSTALL</span>/bin

<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/apps/hadoop-3.1.2
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/bin

<span class="token comment">#kafka </span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KAFKA_HOME</span><span class="token operator">=</span>/apps/kafka_2.12-2.3.0
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">${KAFKA_HOME}</span>/bin

</code></pre></div><ul><li><strong>配置slave1 server.properties</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="token comment"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="token comment"># this work for additional information regarding copyright ownership.</span>
<span class="token comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="token comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span>
<span class="token comment"># the License.  You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token comment"># see kafka.server.KafkaConfig for additional details and defaults</span>

<span class="token comment">############################# Server Basics #############################</span>

<span class="token comment"># The id of the broker. This must be set to a unique integer for each broker.</span>
broker.id<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">############################# Socket Server Settings #############################</span>

<span class="token comment"># The address the socket server listens on. It will get the value returned from </span>
<span class="token comment"># java.net.InetAddress.getCanonicalHostName() if not configured.</span>
<span class="token comment">#   FORMAT:</span>
<span class="token comment">#     listeners = listener_name://host_name:port</span>
<span class="token comment">#   EXAMPLE:</span>
<span class="token comment">#     listeners = PLAINTEXT://your.host.name:9092</span>
<span class="token comment">#listeners=PLAINTEXT://:9092</span>
<span class="token assign-left variable">listeners</span><span class="token operator">=</span>PLAINTEXT://slava1:9092

<span class="token comment"># Hostname and port the broker will advertise to producers and consumers. If not set, </span>
<span class="token comment"># it uses the value for &quot;listeners&quot; if configured.  Otherwise, it will use the value</span>
<span class="token comment"># returned from java.net.InetAddress.getCanonicalHostName().</span>
<span class="token comment">#advertised.listeners=PLAINTEXT://your.host.name:9092</span>

<span class="token comment"># Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details</span>
<span class="token comment">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span>

<span class="token comment"># The number of threads that the server uses for receiving requests from the network and sending responses to the network</span>
num.network.threads<span class="token operator">=</span><span class="token number">3</span>

<span class="token comment"># The number of threads that the server uses for processing requests, which may include disk I/O</span>
num.io.threads<span class="token operator">=</span><span class="token number">8</span>

<span class="token comment"># The send buffer (SO_SNDBUF) used by the socket server</span>
socket.send.buffer.bytes<span class="token operator">=</span><span class="token number">102400</span>

<span class="token comment"># The receive buffer (SO_RCVBUF) used by the socket server</span>
socket.receive.buffer.bytes<span class="token operator">=</span><span class="token number">102400</span>

<span class="token comment"># The maximum size of a request that the socket server will accept (protection against OOM)</span>
socket.request.max.bytes<span class="token operator">=</span><span class="token number">104857600</span>


<span class="token comment">############################# Log Basics #############################</span>

<span class="token comment"># A comma separated list of directories under which to store log files</span>
log.dirs<span class="token operator">=</span>/apps/kafka_2.12-2.3.0/kafka-logs

<span class="token comment"># The default number of log partitions per topic. More partitions allow greater</span>
<span class="token comment"># parallelism for consumption, but this will also result in more files across</span>
<span class="token comment"># the brokers.</span>
num.partitions<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.</span>
<span class="token comment"># This value is recommended to be increased for installations with data dirs located in RAID array.</span>
num.recovery.threads.per.data.dir<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">############################# Internal Topic Settings  #############################</span>
<span class="token comment"># The replication factor for the group metadata internal topics &quot;__consumer_offsets&quot; and &quot;__transaction_state&quot;</span>
<span class="token comment"># For anything other than development testing, a value greater than 1 is recommended for to ensure availability such as 3.</span>
offsets.topic.replication.factor<span class="token operator">=</span><span class="token number">1</span>
transaction.state.log.replication.factor<span class="token operator">=</span><span class="token number">1</span>
transaction.state.log.min.isr<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">############################# Log Flush Policy #############################</span>

<span class="token comment"># Messages are immediately written to the filesystem but by default we only fsync() to sync</span>
<span class="token comment"># the OS cache lazily. The following configurations control the flush of data to disk.</span>
<span class="token comment"># There are a few important trade-offs here:</span>
<span class="token comment">#    1. Durability: Unflushed data may be lost if you are not using replication.</span>
<span class="token comment">#    2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.</span>
<span class="token comment">#    3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.</span>
<span class="token comment"># The settings below allow one to configure the flush policy to flush data after a period of time or</span>
<span class="token comment"># every N messages (or both). This can be done globally and overridden on a per-topic basis.</span>

<span class="token comment"># The number of messages to accept before forcing a flush of data to disk</span>
<span class="token comment">#log.flush.interval.messages=10000</span>

<span class="token comment"># The maximum amount of time a message can sit in a log before we force a flush</span>
<span class="token comment">#log.flush.interval.ms=1000</span>

<span class="token comment">############################# Log Retention Policy #############################</span>

<span class="token comment"># The following configurations control the disposal of log segments. The policy can</span>
<span class="token comment"># be set to delete segments after a period of time, or after a given size has accumulated.</span>
<span class="token comment"># A segment will be deleted whenever *either* of these criteria are met. Deletion always happens</span>
<span class="token comment"># from the end of the log.</span>

<span class="token comment"># The minimum age of a log file to be eligible for deletion due to age</span>
log.retention.hours<span class="token operator">=</span><span class="token number">168</span>

<span class="token comment"># A size-based retention policy for logs. Segments are pruned from the log unless the remaining</span>
<span class="token comment"># segments drop below log.retention.bytes. Functions independently of log.retention.hours.</span>
<span class="token comment">#log.retention.bytes=1073741824</span>

<span class="token comment"># The maximum size of a log segment file. When this size is reached a new log segment will be created.</span>
log.segment.bytes<span class="token operator">=</span><span class="token number">1073741824</span>

<span class="token comment"># The interval at which log segments are checked to see if they can be deleted according</span>
<span class="token comment"># to the retention policies</span>
log.retention.check.interval.ms<span class="token operator">=</span><span class="token number">300000</span>

<span class="token comment">############################# Zookeeper #############################</span>

<span class="token comment"># Zookeeper connection string (see zookeeper docs for details).</span>
<span class="token comment"># This is a comma separated host:port pairs, each corresponding to a zk</span>
<span class="token comment"># server. e.g. &quot;127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002&quot;.</span>
<span class="token comment"># You can also append an optional chroot string to the urls to specify the</span>
<span class="token comment"># root directory for all kafka znodes.</span>
zookeeper.connect<span class="token operator">=</span>master:2181,slave1:2181,slave2:2181

<span class="token comment"># Timeout in ms for connecting to zookeeper</span>
zookeeper.connection.timeout.ms<span class="token operator">=</span><span class="token number">6000</span>


<span class="token comment">############################# Group Coordinator Settings #############################</span>

<span class="token comment"># The following configuration specifies the time, in milliseconds, that the GroupCoordinator will delay the initial consumer rebalance.</span>
<span class="token comment"># The rebalance will be further delayed by the value of group.initial.rebalance.delay.ms as new members join the group, up to a maximum of max.poll.interval.ms.</span>
<span class="token comment"># The default value for this is 3 seconds.</span>
<span class="token comment"># We override this to 0 here as it makes for a better out-of-the-box experience for development and testing.</span>
<span class="token comment"># However, in production environments the default value of 3 seconds is more suitable as this will help to avoid unnecessary, and potentially expensive, rebalances during application startup.</span>
group.initial.rebalance.delay.ms<span class="token operator">=</span><span class="token number">0</span>
</code></pre></div><ul><li><strong>配置slave2 server.properties</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="token comment"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="token comment"># this work for additional information regarding copyright ownership.</span>
<span class="token comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="token comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span>
<span class="token comment"># the License.  You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token comment"># see kafka.server.KafkaConfig for additional details and defaults</span>

<span class="token comment">############################# Server Basics #############################</span>

<span class="token comment"># The id of the broker. This must be set to a unique integer for each broker.</span>
broker.id<span class="token operator">=</span><span class="token number">2</span>

<span class="token comment">############################# Socket Server Settings #############################</span>

<span class="token comment"># The address the socket server listens on. It will get the value returned from </span>
<span class="token comment"># java.net.InetAddress.getCanonicalHostName() if not configured.</span>
<span class="token comment">#   FORMAT:</span>
<span class="token comment">#     listeners = listener_name://host_name:port</span>
<span class="token comment">#   EXAMPLE:</span>
<span class="token comment">#     listeners = PLAINTEXT://your.host.name:9092</span>
<span class="token comment">#listeners=PLAINTEXT://:9092</span>
<span class="token assign-left variable">listeners</span><span class="token operator">=</span>PLAINTEXT://slave2:9092

<span class="token comment"># Hostname and port the broker will advertise to producers and consumers. If not set, </span>
<span class="token comment"># it uses the value for &quot;listeners&quot; if configured.  Otherwise, it will use the value</span>
<span class="token comment"># returned from java.net.InetAddress.getCanonicalHostName().</span>
<span class="token comment">#advertised.listeners=PLAINTEXT://your.host.name:9092</span>

<span class="token comment"># Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details</span>
<span class="token comment">#listener.security.protocol.map=PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span>

<span class="token comment"># The number of threads that the server uses for receiving requests from the network and sending responses to the network</span>
num.network.threads<span class="token operator">=</span><span class="token number">3</span>

<span class="token comment"># The number of threads that the server uses for processing requests, which may include disk I/O</span>
num.io.threads<span class="token operator">=</span><span class="token number">8</span>

<span class="token comment"># The send buffer (SO_SNDBUF) used by the socket server</span>
socket.send.buffer.bytes<span class="token operator">=</span><span class="token number">102400</span>

<span class="token comment"># The receive buffer (SO_RCVBUF) used by the socket server</span>
socket.receive.buffer.bytes<span class="token operator">=</span><span class="token number">102400</span>

<span class="token comment"># The maximum size of a request that the socket server will accept (protection against OOM)</span>
socket.request.max.bytes<span class="token operator">=</span><span class="token number">104857600</span>


<span class="token comment">############################# Log Basics #############################</span>

<span class="token comment"># A comma separated list of directories under which to store log files</span>
log.dirs<span class="token operator">=</span>/apps/kafka_2.12-2.3.0/kafka-logs

<span class="token comment"># The default number of log partitions per topic. More partitions allow greater</span>
<span class="token comment"># parallelism for consumption, but this will also result in more files across</span>
<span class="token comment"># the brokers.</span>
num.partitions<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># The number of threads per data directory to be used for log recovery at startup and flushing at shutdown.</span>
<span class="token comment"># This value is recommended to be increased for installations with data dirs located in RAID array.</span>
num.recovery.threads.per.data.dir<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">############################# Internal Topic Settings  #############################</span>
<span class="token comment"># The replication factor for the group metadata internal topics &quot;__consumer_offsets&quot; and &quot;__transaction_state&quot;</span>
<span class="token comment"># For anything other than development testing, a value greater than 1 is recommended for to ensure availability such as 3.</span>
offsets.topic.replication.factor<span class="token operator">=</span><span class="token number">1</span>
transaction.state.log.replication.factor<span class="token operator">=</span><span class="token number">1</span>
transaction.state.log.min.isr<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">############################# Log Flush Policy #############################</span>

<span class="token comment"># Messages are immediately written to the filesystem but by default we only fsync() to sync</span>
<span class="token comment"># the OS cache lazily. The following configurations control the flush of data to disk.</span>
<span class="token comment"># There are a few important trade-offs here:</span>
<span class="token comment">#    1. Durability: Unflushed data may be lost if you are not using replication.</span>
<span class="token comment">#    2. Latency: Very large flush intervals may lead to latency spikes when the flush does occur as there will be a lot of data to flush.</span>
<span class="token comment">#    3. Throughput: The flush is generally the most expensive operation, and a small flush interval may lead to excessive seeks.</span>
<span class="token comment"># The settings below allow one to configure the flush policy to flush data after a period of time or</span>
<span class="token comment"># every N messages (or both). This can be done globally and overridden on a per-topic basis.</span>

<span class="token comment"># The number of messages to accept before forcing a flush of data to disk</span>
<span class="token comment">#log.flush.interval.messages=10000</span>

<span class="token comment"># The maximum amount of time a message can sit in a log before we force a flush</span>
<span class="token comment">#log.flush.interval.ms=1000</span>

<span class="token comment">############################# Log Retention Policy #############################</span>

<span class="token comment"># The following configurations control the disposal of log segments. The policy can</span>
<span class="token comment"># be set to delete segments after a period of time, or after a given size has accumulated.</span>
<span class="token comment"># A segment will be deleted whenever *either* of these criteria are met. Deletion always happens</span>
<span class="token comment"># from the end of the log.</span>

<span class="token comment"># The minimum age of a log file to be eligible for deletion due to age</span>
log.retention.hours<span class="token operator">=</span><span class="token number">168</span>

<span class="token comment"># A size-based retention policy for logs. Segments are pruned from the log unless the remaining</span>
<span class="token comment"># segments drop below log.retention.bytes. Functions independently of log.retention.hours.</span>
<span class="token comment">#log.retention.bytes=1073741824</span>

<span class="token comment"># The maximum size of a log segment file. When this size is reached a new log segment will be created.</span>
log.segment.bytes<span class="token operator">=</span><span class="token number">1073741824</span>

<span class="token comment"># The interval at which log segments are checked to see if they can be deleted according</span>
<span class="token comment"># to the retention policies</span>
log.retention.check.interval.ms<span class="token operator">=</span><span class="token number">300000</span>

<span class="token comment">############################# Zookeeper #############################</span>

<span class="token comment"># Zookeeper connection string (see zookeeper docs for details).</span>
<span class="token comment"># This is a comma separated host:port pairs, each corresponding to a zk</span>
<span class="token comment"># server. e.g. &quot;127.0.0.1:3000,127.0.0.1:3001,127.0.0.1:3002&quot;.</span>
<span class="token comment"># You can also append an optional chroot string to the urls to specify the</span>
<span class="token comment"># root directory for all kafka znodes.</span>
zookeeper.connect<span class="token operator">=</span>master:2181,slave1:2181,slave2:2181

<span class="token comment"># Timeout in ms for connecting to zookeeper</span>
zookeeper.connection.timeout.ms<span class="token operator">=</span><span class="token number">6000</span>


<span class="token comment">############################# Group Coordinator Settings #############################</span>

<span class="token comment"># The following configuration specifies the time, in milliseconds, that the GroupCoordinator will delay the initial consumer rebalance.</span>
<span class="token comment"># The rebalance will be further delayed by the value of group.initial.rebalance.delay.ms as new members join the group, up to a maximum of max.poll.interval.ms.</span>
<span class="token comment"># The default value for this is 3 seconds.</span>
<span class="token comment"># We override this to 0 here as it makes for a better out-of-the-box experience for development and testing.</span>
<span class="token comment"># However, in production environments the default value of 3 seconds is more suitable as this will help to avoid unnecessary, and potentially expensive, rebalances during application startup.</span>
group.initial.rebalance.delay.ms<span class="token operator">=</span><span class="token number">0</span>
</code></pre></div><ul><li><strong>创建目录</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>runRemoteCmd.sh <span class="token string">&quot;mkdir -p /apps/kafka_2.12-2.3.0/kafka-logs&quot;</span> all
</code></pre></div><ul><li><strong>启动Kafka</strong></li></ul> <p>一键启动Kafka</p> <div class="language-shell extra-class"><pre class="language-shell"><code>runRemoteCmd.sh <span class="token string">&quot;/apps/kafka_2.12-2.3.0/bin/kafka-server-start.sh -daemon /apps/kafka_2.12-2.3.0/config/server.properties&quot;</span> all
</code></pre></div><ul><li><strong>测试运行Kafka</strong></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#使用自带脚本向topic 发送数据</span>
bin/kafka-console-producer.sh --broker-list master:9092 --topic <span class="token builtin class-name">test</span>
<span class="token comment">#使用自带脚本消费topic 数据（从头消费数据）</span>
bin/kafka-console-consumer.sh --bootstrap-server master:9092 --topic <span class="token builtin class-name">test</span>
--from-beginning
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.fb1232a2.js" defer></script><script src="/assets/js/2.7b8aa595.js" defer></script><script src="/assets/js/21.feab52c3.js" defer></script>
  </body>
</html>
