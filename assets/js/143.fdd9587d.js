(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{501:function(s,a,e){"use strict";e.r(a);var t=e(44),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("k8s安装(使用kubeadm)")]),s._v(" "),e("h2",{attrs:{id:"介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),e("p",[s._v("[TOC]")]),s._v(" "),e("p",[e("strong",[s._v("主机配置:")])]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("主机名")]),s._v(" "),e("th",[s._v("IP地址")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("master")]),s._v(" "),e("td",[s._v("192.168.153.130")])]),s._v(" "),e("tr",[e("td",[s._v("node1")]),s._v(" "),e("td",[s._v("192.168.153.131")])]),s._v(" "),e("tr",[e("td",[s._v("node2")]),s._v(" "),e("td",[s._v("192.168.153.132")])])])]),s._v(" "),e("p",[e("strong",[s._v("系统：CentOS7")])]),s._v(" "),e("p",[e("strong",[s._v("docker版本：19.03.5")])]),s._v(" "),e("p",[e("strong",[s._v("k8s版本：1.16.2")])]),s._v(" "),e("p",[e("strong",[s._v("1. k8s安装")])]),s._v(" "),e("ul",[e("li",[s._v("修改主机名")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#永久修改主机名，你可以修改静态主机名")]),s._v("\nhostnamectl --static set-hostname "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("host-name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("ul",[e("li",[s._v("关闭防火墙、swap、selinux")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙")]),s._v("\nsystemctl stop firewalld "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl disable firewalld\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭swap")]),s._v("\nswapoff -a\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/swap/s/^\\(.*\\)$/#\\1/g'")]),s._v(" /etc/fstab\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭selinux")]),s._v("\nsetenforce "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/selinux/config\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SELINUX修改为disabled")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUX")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("disabled\n")])])]),e("ul",[e("li",[s._v("系统参数设置")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 制作配置文件")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysctl.d/kubernetes.conf "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nnet.bridge.bridge-nf-call-iptables=1\nnet.bridge.bridge-nf-call-ip6tables=1\nnet.ipv4.ip_forward=1\nvm.swappiness=0\nvm.overcommit_memory=1\nvm.panic_on_oom=0\nfs.inotify.max_user_watches=89100\nEOF")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生效文件")]),s._v("\n$ sysctl -p /etc/sysctl.d/kubernetes.conf\n")])])]),e("ul",[e("li",[s._v("配置K8S源")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 配置k8s源")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),e("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo")]),s._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nEOF")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 重建yum缓存")]),s._v("\nyum clean all\nyum makecache fast\nyum -y update\n")])])]),e("ul",[e("li",[s._v("安装kubeadm，kubelet")])]),s._v(" "),e("div",{staticClass:"language-http extra-class"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[s._v("yum install -y kubeadm kubelet\n")])])]),e("ul",[e("li",[e("p",[s._v("初始化kubeadm")]),s._v(" "),e("ul",[e("li",[s._v("这里不直接初始化，因为国内用户不能直接拉取相关的镜像，所以这里想查看需要的镜像版本")])]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubeadm config images list\n")])])]),e("ul",[e("li",[s._v("根据需要的版本，直接拉取国内镜像，并修改tag")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" kubeadm.sh\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 使用如下脚本下载国内镜像，并修改tag为google的tag")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -e\n \n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1.16.2\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBE_PAUSE_VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ETCD_VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),s._v(".15-0\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CORE_DNS_VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),s._v(".2\n \n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GCR_URL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("k8s.gcr.io\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALIYUN_URL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-hangzhou.aliyuncs.com/google_containers\n \n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("images")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kube-proxy:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_VERSION}")]),s._v("\nkube-scheduler:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_VERSION}")]),s._v("\nkube-controller-manager:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_VERSION}")]),s._v("\nkube-apiserver:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_VERSION}")]),s._v("\npause:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${KUBE_PAUSE_VERSION}")]),s._v("\netcd:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ETCD_VERSION}")]),s._v("\ncoredns:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CORE_DNS_VERSION}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("imageName")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${images"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  docker pull "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ALIYUN_URL")]),s._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n  docker tag  "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ALIYUN_URL")]),s._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GCR_URL")]),s._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n  docker rmi "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ALIYUN_URL")]),s._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),e("ul",[e("li",[s._v("运行脚本，拉取镜像")])]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("./kubeadm.sh\n")])])])]),s._v(" "),e("li",[e("p",[s._v("master节点安装")])])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" kubeadm init "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --apiserver-advertise-address "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".153.130 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --kubernetes-version"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1.16.2 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --pod-network-cidr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16\n")])])]),e("ul",[e("li",[s._v("获取添加节点命令")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm token create --print-join-command\n")])])]),e("ul",[e("li",[s._v("node节点安装（使用获取到的命令安装node节点）")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".153.130:6443 --token re24q1.7sin74aq7c0awnru "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:82e68e2af70c642e7307c68505f513149c364867fd368ab0305c85ad2777f037 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   --ignore-preflight-errors"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("all \n")])])]),e("ul",[e("li",[e("p",[s._v("安装flanneld")]),s._v(" "),e("ul",[e("li",[s._v("master节点上执行如下命令")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])])]),e("ul",[e("li",[s._v("下载flannel配置文件")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n")])])]),e("ul",[e("li",[s._v("因为kube-flannel.yml文件中使用的镜像为quay.io的，国内无法拉取，所以同样的先从国内源上下载，再修改tag，脚本如下")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" flanneld.sh\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" -e\n \n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FLANNEL_VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v0.11.0\n \n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在这里修改源")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("QUAY_URL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("quay.io/coreos\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("QINIU_URL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("quay-mirror.qiniu.com/coreos\n \n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("images")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("flannel:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FLANNEL_VERSION}")]),s._v("-amd64\nflannel:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FLANNEL_VERSION}")]),s._v("-arm64\nflannel:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FLANNEL_VERSION}")]),s._v("-arm\nflannel:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FLANNEL_VERSION}")]),s._v("-ppc64le\nflannel:"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FLANNEL_VERSION}")]),s._v("-s390x"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("imageName")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${images"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  docker pull "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$QINIU_URL")]),s._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n  docker tag  "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$QINIU_URL")]),s._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$QUAY_URL")]),s._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n  docker rmi "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$QINIU_URL")]),s._v("/"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$imageName")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),e("ul",[e("li",[s._v("运行脚本，这个脚本需要在每个节点上执行")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("./flanneld.sh\n")])])]),e("ul",[e("li",[s._v("安装flanneld")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl apply -f kube-flannel.yml\n")])])]),e("ul",[e("li",[s._v("查看是否正常")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$  kubectl get pod -n kube-system\nNAME                                 READY   STATUS    RESTARTS   AGE\ncoredns-5644d7b6d9-g7hnf             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\ncoredns-5644d7b6d9-ll2vr             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\netcd-k8s-master                      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          11m\nkube-apiserver-k8s-master            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          11m\nkube-controller-manager-k8s-master   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          11m\nkube-flannel-ds-amd64-7fqhp          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          30s\nkube-flannel-ds-amd64-t87t6          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          30s\nkube-flannel-ds-amd64-t8d6f          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          30s\nkube-proxy-dv7fl                     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          9m29s\nkube-proxy-gbfvx                     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          8m37s\nkube-proxy-ndm5m                     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          12m\nkube-scheduler-k8s-master            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          11m\n")])])]),e("ul",[e("li",[s._v("查看集群是否正常")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ kubectl get nodes\nNAME         STATUS   ROLES    AGE     VERSION\nk8s-master   Ready    master   13m     v1.16.2\nk8s-node01   Ready    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   9m55s   v1.16.2\nk8s-node02   Ready    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   9m3s    v1.16.2\n")])])])]),s._v(" "),e("li",[e("p",[s._v("Dashboard安装")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("运行以下命令")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta6/aio/deploy/recommended.yaml\n")])])])]),s._v(" "),e("li",[e("p",[s._v("启动dashboard")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl proxy --address"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),s._v("  --accept-hosts"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^*$'")]),s._v("\n")])])])]),s._v(" "),e("li",[e("p",[s._v("访问dashboard")]),s._v(" "),e("div",{staticClass:"language-http extra-class"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("http:")]),s._v("//192.168.153.132:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/\n")])])])]),s._v(" "),e("li",[e("p",[s._v("登录dashboard")])])]),s._v(" "),e("p",[s._v("Dashboard 默认只支持 token 认证，所以如果使用 KubeConfig 文件，需要在该文件中指定 token，我们这里使用token的方式登录")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建service account")]),s._v("\n$ kubectl create sa dashboard-admin -n kube-system\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建角色绑定关系")]),s._v("\n$ kubectl create clusterrolebinding dashboard-admin --clusterrole"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cluster-admin --serviceaccount"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-system:dashboard-admin\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看dashboard-admin的secret名字")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ADMIN_SECRET")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get secrets -n kube-system "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" dashboard-admin "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印secret的token")]),s._v("\n$ kubectl describe secret -n kube-system "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ADMIN_SECRET}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -E "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^token'")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),s._v("\n")])])])]),s._v(" "),e("li",[e("p",[s._v("问题解决")]),s._v(" "),e("ul",[e("li",[e("p",[s._v('访问dashboard报“ no endpoints available for service "kubernetes-dashboard ”错误')]),s._v(" "),e("p",[s._v("解决方案： 因为我的dashboard是装在master上，然后k8s服务image是在node上，在master上操作没关注node上image是否在启动，最后node的镜像启动了，访问就没问题了")])]),s._v(" "),e("li",[e("p",[s._v("node节点使用kubectl命令报：“The connection to the server localhost:8080 was refused - did you specify the right host or port”错误")]),s._v(" "),e("p",[s._v("解决方案： 执行以下命令  export KUBECONFIG=/etc/kubernetes/admin.conf （如果node节点没有admin.conf，请从master节点相同路径获取）")])])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);