(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{389:function(e,n,t){"use strict";t.r(n);var s=t(44),a=Object(s.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"redis集群搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis集群搭建"}},[e._v("#")]),e._v(" Redis集群搭建")]),e._v(" "),t("h2",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[e._v("#")]),e._v(" 介绍")]),e._v(" "),t("p",[e._v("[TOC]")]),e._v(" "),t("p",[t("strong",[e._v("环境：CentOS7、Redis-5.0.4版本。")])]),e._v(" "),t("p",[e._v("1、 Redis官网("),t("a",{attrs:{href:"http://redis.io/download",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://redis.io/download"),t("OutboundLink")],1),e._v(")下载Redis。下载地址："),t("a",{attrs:{href:"http://download.redis.io/releases/redis-5.0.4.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://download.redis.io/releases/redis-5.0.4.tar.gz"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("2、 将下载的Redis文件上传到CentOS系统中。")]),e._v(" "),t("p",[e._v("3、 安装gcc")]),e._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[e._v("yum install gcc-c++\n")])])]),t("p",[e._v("4、 解压文件")]),e._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[e._v("tar -zvxf redis-5.0.4.tar.gz\n")])])]),t("p",[e._v("5、执行make命令")]),e._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[e._v("cd redis-5.0.4\nmake\n")])])]),t("p",[e._v("6、修改redis-5.0.4/utils/create-cluster目录下create-cluster脚本,其中PORT=30000，NODES=6表示集群有6个节点，端口从30001开始至30006，可以根据自身需求自行调整，如需远程访问，请在--daemonize yes 后加入protected-mode no，并将127.0.0.1换为本机地址")]),e._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[e._v('#!/bin/bash\n\n# Settings\nPORT=30000\nTIMEOUT=2000\nNODES=6\nREPLICAS=1\n\n# You may want to put the above config parameters into config.sh in order to\n# override the defaults without modifying this script.\n\nif [ -a config.sh ]\nthen\n    source "config.sh"\nfi\n\n# Computed vars\nENDPORT=$((PORT+NODES))\n\nif [ "$1" == "start" ]\nthen\n    while [ $((PORT < ENDPORT)) != "0" ]; do\n        PORT=$((PORT+1))\n        echo "Starting $PORT"\n        ../../src/redis-server --port $PORT --cluster-enabled yes --cluster-config-file nodes-${PORT}.conf --cluster-node-timeout $TIMEOUT --appendonly yes --appendfilename appendonly-${PORT}.aof --dbfilename dump-${PORT}.rdb --logfile ${PORT}.log --daemonize yes\n    done\n    exit 0\nfi\n\nif [ "$1" == "create" ]\nthen\n    HOSTS=""\n    while [ $((PORT < ENDPORT)) != "0" ]; do\n        PORT=$((PORT+1))\n        HOSTS="$HOSTS 127.0.0.1:$PORT"\n    done\n    ../../src/redis-cli --cluster create $HOSTS --cluster-replicas $REPLICAS\n    exit 0\nfi\n\nif [ "$1" == "stop" ]\nthen\n    while [ $((PORT < ENDPORT)) != "0" ]; do\n        PORT=$((PORT+1))\n        echo "Stopping $PORT"\n        ../../src/redis-cli -p $PORT shutdown nosave\n    done\n    exit 0\nfi\n\nif [ "$1" == "watch" ]\nthen\n    PORT=$((PORT+1))\n    while [ 1 ]; do\n        clear\n        date\n        ../../src/redis-cli -p $PORT cluster nodes | head -30\n        sleep 1\n    done\n    exit 0\nfi\n\nif [ "$1" == "tail" ]\nthen\n    INSTANCE=$2\n    PORT=$((PORT+INSTANCE))\n    tail -f ${PORT}.log\n    exit 0\nfi\n\nif [ "$1" == "call" ]\nthen\n    while [ $((PORT < ENDPORT)) != "0" ]; do\n        PORT=$((PORT+1))\n        ../../src/redis-cli -p $PORT $2 $3 $4 $5 $6 $7 $8 $9\n    done\n    exit 0\nfi\n\nif [ "$1" == "clean" ]\nthen\n    rm -rf *.log\n    rm -rf appendonly*.aof\n    rm -rf dump*.rdb\n    rm -rf nodes*.conf\n    exit 0\nfi\n\nif [ "$1" == "clean-logs" ]\nthen\n    rm -rf *.log\n    exit 0\nfi\n\necho "Usage: $0 [start|create|stop|watch|tail|clean]"\necho "start       -- Launch Redis Cluster instances."\necho "create      -- Create a cluster using redis-cli --cluster create."\necho "stop        -- Stop Redis Cluster instances."\necho "watch       -- Show CLUSTER NODES output (first 30 lines) of first node."\necho "tail '),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),e._v("id")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),e._v('   -- Run tail -f of instance at base port + ID."\necho "clean       -- Remove all instances data, logs, configs."\necho "clean-logs  -- Remove just instances logs."\n')])])]),t("p",[e._v("7、创建集群,运行以下命令，在选则框中选择yes：")]),e._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[e._v("./create-cluster start\n./create-cluster create\n")])])]),t("p",[e._v("8、停止集群：")]),e._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[e._v("./create-cluster stop\n")])])]),t("p",[e._v("9、参数说明")]),e._v(" "),t("div",{staticClass:"language-html extra-class"},[t("pre",{pre:!0,attrs:{class:"language-html"}},[t("code",[e._v("port  7000                                        //端口7000,7002,7003        \nbind 本机ip                                       //默认ip为127.0.0.1 需要改为其他节点机器可访问的ip 否则创建集群时无法访问对应的端口，无法创建集群\ndaemonize    yes                               //redis后台运行\npidfile  /var/run/redis_7000.pid          //pidfile文件对应7000,7001,7002\ncluster-enabled  yes                           //开启集群  把注释#去掉\ncluster-config-file  nodes_7000.conf   //集群的配置  配置文件首次启动自动生成 7000,7001,7002\ncluster-node-timeout  15000                //请求超时  默认15秒，可自行设置\nappendonly  yes                           //aof日志开启  有需要就开启，它会每次写操作都记录一条日志\n")])])])])}),[],!1,null,null,null);n.default=a.exports}}]);