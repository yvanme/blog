(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{395:function(e,t,s){"use strict";s.r(t);var a=s(44),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"zookeeper安装-集群版"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper安装-集群版"}},[e._v("#")]),e._v(" Zookeeper安装（集群版）")]),e._v(" "),s("h2",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[e._v("#")]),e._v(" 介绍")]),e._v(" "),s("p",[e._v("[TOC]")]),e._v(" "),s("p",[s("strong",[e._v("环境：CentOS7、zookeeper-3.4.14版本")])]),e._v(" "),s("p",[s("strong",[e._v("主机配置:")])]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("主机名")]),e._v(" "),s("th",[e._v("IP地址")]),e._v(" "),s("th",[e._v("JDK")]),e._v(" "),s("th",[e._v("ZooKeeper")]),e._v(" "),s("th",[e._v("myid")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("master")]),e._v(" "),s("td",[e._v("192.168.153.131")]),e._v(" "),s("td",[e._v("1.8.0_201")]),e._v(" "),s("td",[e._v("server.1")]),e._v(" "),s("td",[e._v("1")])]),e._v(" "),s("tr",[s("td",[e._v("slave1")]),e._v(" "),s("td",[e._v("192.168.153.132")]),e._v(" "),s("td",[e._v("1.8.0_201")]),e._v(" "),s("td",[e._v("server.2")]),e._v(" "),s("td",[e._v("2")])]),e._v(" "),s("tr",[s("td",[e._v("slave2")]),e._v(" "),s("td",[e._v("192.168.153.133")]),e._v(" "),s("td",[e._v("1.8.0_201")]),e._v(" "),s("td",[e._v("server.3")]),e._v(" "),s("td",[e._v("3")])])])]),e._v(" "),s("p",[s("strong",[e._v("安装目录：/apps/zookeeper-3.4.14")])]),e._v(" "),s("p",[s("strong",[e._v("备注：zookeeper依赖java，因此在安装zookeeper之前需要安装好java环境")])]),e._v(" "),s("p",[e._v("1、 官网(https://zookeeper.apache.org/releases.html#download)下载Zookeeper。下载地址："),s("a",{attrs:{href:"http://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://mirror.bit.edu.cn/apache/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("2、 将下载的Zookeeper文件上传到CentOS系统中。")]),e._v(" "),s("p",[e._v("3、 解压文件")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" -zxvf zookeeper-3.4.14.tar.gz\n")])])]),s("p",[e._v("4、进入到conf目录")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" zookeeper-3.4.14/conf\n")])])]),s("p",[e._v("5、将zoo_sample.cfg拷贝一份为zoo.cfg")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" zoo_sample.cfg zoo.cfg\n")])])]),s("p",[e._v("6、修改zoo.cfg配置文件")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# The number of milliseconds of each tick")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2000")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# The number of ticks that the initial ")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# synchronization phase can take")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# The number of ticks that can pass between ")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# sending a request and getting an acknowledgement")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("5")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the directory where the snapshot is stored.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# do not use /tmp for storage, /tmp here is just ")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# example sakes.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#数据存放目录")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/tmp/zookeeper\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("dataLogDir")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/tmp/zookeeper/log\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the port at which the clients will connect")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#服务的端口号")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("2181")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the maximum number of client connections.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# increase this if you need to handle more clients")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#maxClientCnxns=60")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Be sure to read the maintenance section of the ")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# administrator guide before turning on autopurge.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# The number of snapshots to retain in dataDir")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#autopurge.snapRetainCount=3")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Purge task interval in hours")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v('# Set to "0" to disable auto purge feature')]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#autopurge.purgeInterval=1")]),e._v("\nserver.1"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),e._v(".153.131:2888:3888\nserver.2"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),e._v(".153.132:2888:3888\nserver.3"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),e._v(".153.133:2888:3888\n\n")])])]),s("p",[s("strong",[e._v("配置参数说明")])]),e._v(" "),s("blockquote",[s("p",[e._v("tickTime:这个时间是作为zookeeper服务器之间或客户端与服务器之间维持心跳的时间间隔,也就是说每个tickTime时间就会发送一个心跳。")]),e._v(" "),s("p",[e._v("initLimit:这个配置项是用来配置zookeeper接受客户端（这里所说的客户端不是用户连接zookeeper服务器的客户端,而是zookeeper服务器集群中连接到leader的follower 服务器）初始化连接时最长能忍受多少个心跳时间间隔数。")]),e._v(" "),s("p",[e._v("当已经超过10个心跳的时间（也就是tickTime）长度后 zookeeper 服务器还没有收到客户端的返回信息,那么表明这个客户端连接失败。总的时间长度就是 10*2000=20秒。")]),e._v(" "),s("p",[e._v("syncLimit:这个配置项标识leader与follower之间发送消息,请求和应答时间长度,最长不能超过多少个tickTime的时间长度,总的时间长度就是5*2000=10秒。")]),e._v(" "),s("p",[e._v("dataDir:顾名思义就是zookeeper保存数据的目录,默认情况下zookeeper将写数据的日志文件也保存在这个目录里；")]),e._v(" "),s("p",[e._v("clientPort:这个端口就是客户端连接Zookeeper服务器的端口,Zookeeper会监听这个端口接受客户端的访问请求；")]),e._v(" "),s("p",[e._v("server.A=B:C:D:中的A是一个数字,表示这个是第几号服务器,B是这个服务器的IP地址，C第一个端口用来集群成员的信息交换,表示这个服务器与集群中的leader服务器交换信息的端口，D是在leader挂掉时专门用来进行选举leader所用的端口。")])]),e._v(" "),s("p",[e._v("7、创建ServerID标识")]),e._v(" "),s("p",[e._v("除了修改zoo.cfg配置文件外,zookeeper集群模式下还要配置一个myid文件,这个文件需要放在dataDir目录下。")]),e._v(" "),s("p",[e._v("这个文件里面有一个数据就是A的值（该A就是zoo.cfg文件中server.A=B:C:D中的A）,在zoo.cfg文件中配置的dataDir路径中创建myid文件。值同时与zoo.cfg文件里面的server.1保持一致，如下")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#192.168.153.131")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"1"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" /tmp/zookeeper/myid\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#192.168.153.132")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"2"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" /tmp/zookeeper/myid\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#192.168.153.133")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"3"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" /tmp/zookeeper/myid\n")])])]),s("p",[e._v("8、设置环境变量")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#修改/etc/profile文件")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("vi")]),e._v(" /etc/profile\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#加入以下配置")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ZOOKEEPER_INSTALL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/apps/zookeeper-3.4.14\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("PATH")])]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token environment constant"}},[e._v("$PATH")]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$ZOOKEEPER_INSTALL")]),e._v("/bin\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#使配置生效")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("source")]),e._v(" /etc/profile\n")])])]),s("p",[e._v("9、启动zookeeper")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("zkServer.sh start\n")])])]),s("p",[e._v("10、查看zookeeper状态")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("zkServer.sh status\n")])])]),s("p",[e._v("zookeeper连接测试")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("zkCli.sh -server "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("192.168")]),e._v(".153.133:2181 \n")])])]),s("p",[e._v("11、停止zookeeper")]),e._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("zkServer.sh stop\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);