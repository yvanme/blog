(window.webpackJsonp=window.webpackJsonp||[]).push([[147],{505:function(t,s,e){"use strict";e.r(s);var n=e(44),a=Object(n.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("k8s安装(使用kubeadm)")]),t._v(" "),e("h2",{attrs:{id:"介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),e("p",[t._v("[TOC]")]),t._v(" "),e("p",[e("strong",[t._v("主机配置:")])]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("主机名")]),t._v(" "),e("th",[t._v("IP地址")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("master")]),t._v(" "),e("td",[t._v("192.168.153.130")])]),t._v(" "),e("tr",[e("td",[t._v("node1")]),t._v(" "),e("td",[t._v("192.168.153.131")])]),t._v(" "),e("tr",[e("td",[t._v("node2")]),t._v(" "),e("td",[t._v("192.168.153.132")])])])]),t._v(" "),e("p",[e("strong",[t._v("系统：CentOS7")])]),t._v(" "),e("p",[e("strong",[t._v("docker版本：19.03.5")])]),t._v(" "),e("p",[e("strong",[t._v("k8s版本：1.9.0")])]),t._v(" "),e("p",[e("strong",[t._v("1. k8s安装")])]),t._v(" "),e("ul",[e("li",[t._v("安装kube-proxy报错")])]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#执行降级操作命令")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" -Uvh --oldpackage iptables-1.4.21-24.el7.x86_64.rpm\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#执行完记得执行一下")]),t._v("\nldconfig\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#验证是否安装成功")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" -qa"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" iptables\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启 kube-proxy")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" kube-proxy restart\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看")]),t._v("\njournalctl -f -u kube-proxy\n")])])]),e("ul",[e("li",[e("p",[t._v("iptables常用命令")]),t._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[t._v("systemctl start iptables "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#启动")]),t._v("\n\nsystemctl status iptables "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看运行状态")]),t._v("\n\nsystemctl restart iptables.service "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启")]),t._v("\n\nsystemctl stop iptables.service "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#停止")]),t._v("\n\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" iptables.service "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置开机启动")]),t._v("\n\nsystemctl disable iptables.service "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#禁止开机启动")]),t._v("\n\niptables -h "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查询帮助")]),t._v("\n\niptables -L -n "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#列出（filter表）所有规则")]),t._v("\n\niptables -L -n --line-number "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#列出（filter表）所有规则，带编号")]),t._v("\n\niptables -L -n -t nat "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#列出（nat表）所有规则")]),t._v("\n\niptables -F "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#清除（filter表）中所有规则")]),t._v("\n\niptables -F -t nat "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#清除（nat表）中所有规则")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" iptables save "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#保存配置（保存配置后必须重启iptables）")]),t._v("\n\nsystemctl restart iptables.service "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#重启")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#禁止192.168.1.3 IP地址的所有类型数据接入")]),t._v("\niptables -A INPUT "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" -s "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.3 -j DROP\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开放端口")]),t._v("\niptables -A INPUT -p tcp --dport "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" -j ACCEPT "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开放80端口")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开放端口范围")]),t._v("\niptables -I INPUT -p tcp --dport "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":80 -j ACCEPT "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开发22-80范围的端口")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#不允许80端口流出")]),t._v("\niptables -I OUTPUT -p tcp --dport "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" -j DROP\n")])])])])])])}),[],!1,null,null,null);s.default=a.exports}}]);