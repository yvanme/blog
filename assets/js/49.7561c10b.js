(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{407:function(a,s,t){"use strict";t.r(s);var e=t(44),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"hadoop问题汇总"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hadoop问题汇总"}},[a._v("#")]),a._v(" Hadoop问题汇总")]),a._v(" "),t("h2",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[a._v("#")]),a._v(" 介绍")]),a._v(" "),t("p",[a._v("[TOC]")]),a._v(" "),t("p",[t("strong",[a._v("环境：CentOS7、hadoop-3.1.2版本")])]),a._v(" "),t("p",[a._v("问题：hadoop 找不到或无法加载主类org.apache.hadoop.mapreduce.v2.app.MRAppMaster")]),a._v(" "),t("p",[a._v("解决方法：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("hadoop  classpath\n")])])]),t("p",[a._v("输出为：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("/apps/hadoop-3.1.2/etc/hadoop:/apps/hadoop-3.1.2/share/hadoop/common/lib/*:/apps/hadoop-3.1.2/share/hadoop/common/*:/apps/hadoop-3.1.2/share/hadoop/hdfs:/apps/hadoop-3.1.2/share/hadoop/hdfs/lib/*:/apps/hadoop-3.1.2/share/hadoop/hdfs/*:/apps/hadoop-3.1.2/share/hadoop/mapreduce/lib/*:/apps/hadoop-3.1.2/share/hadoop/mapreduce/*:/apps/hadoop-3.1.2/share/hadoop/yarn:/apps/hadoop-3.1.2/share/hadoop/yarn/lib/*:/apps/hadoop-3.1.2/share/hadoop/yarn/*\n")])])]),t("p",[a._v("将该内容设置到yarn-siet.xml：")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("yarn.application.classpath"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("/apps/hadoop-3.1.2/etc/hadoop:/apps/hadoop-3.1.2/share/hadoop/common/lib/*:/apps/hadoop-3.1.2/share/hadoop/common/*:/apps/hadoop-3.1.2/share/hadoop/hdfs:/apps/hadoop-3.1.2/share/hadoop/hdfs/lib/*:/apps/hadoop-3.1.2/share/hadoop/hdfs/*:/apps/hadoop-3.1.2/share/hadoop/mapreduce/lib/*:/apps/hadoop-3.1.2/share/hadoop/mapreduce/*:/apps/hadoop-3.1.2/share/hadoop/yarn:/apps/hadoop-3.1.2/share/hadoop/yarn/lib/*:/apps/hadoop-3.1.2/share/hadoop/yarn/*\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("p",[a._v("​")]),a._v(" "),t("p",[a._v("问题：主从namenode都处于standby状态")]),a._v(" "),t("p",[a._v("解决方法：")]),a._v(" "),t("p",[a._v("一直工作正常的集群，由于机房电源故障，造成部分datanode硬盘故障，一共有几十个blocks丢失，重新运行集群后，主从namenode都处于standby的状态，以下是处理的主要过程。在开始维护之前，可先运行 hdfs haadmin -getServiceState nn1 或是 hdfs haadmin -getServiceState nn2 ，来用命令行检查当前状态，这里nn1 和 nn2 是指在hdfs-site.xml 中的配置namenode\n一、运行zkfc\n先确保zookeeper处于正常工作状态，然后在主从namenode上运行 hadoop-daemon.sh start zkfc\n二、namenode的safemode模式\nsafemode是namenode的一种状态，正是由于blocks的丢失，namenode进入safemode状态，此时不能数据进行操作，只能查看元数据，执行 hadoop dfsadmin -safemode leave"),t("br"),a._v("\n执行后，集群工作正常")]),a._v(" "),t("p",[a._v("三、处理missing blocks故障")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("    报错信息是 “There are ** missing blocks. The following files may be corrupted:”\n\n    “Please check the logs or run fsck in order to identify the missing blocks. See the Hadoop FAQ for common causes and potential solutions.”\n\n    执行命令 hadoop fsck -delete\n\n    成功删除丢失的数据块。\n")])])]),t("p",[a._v("参考链接"),t("a",{attrs:{href:"https://blog.csdn.net/lepton126/article/details/82977952",target:"_blank",rel:"noopener noreferrer"}},[a._v("主从namenode都处于standby状态"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("问题：Container is running beyond virtual memory limits. Current usage: 611.1 MB of 1 GB physical memory u")]),a._v(" "),t("p",[a._v("解决方法：")]),a._v(" "),t("p",[a._v("异常分析\n611.1MB: 任务所占的物理内存")]),a._v(" "),t("p",[a._v("1GB 是mapreduce.map.memory.mb 设置的")]),a._v(" "),t("p",[a._v("4.9G 是程序占用的虚拟内存： 什么是虚拟内存以及和物理内存的关系")]),a._v(" "),t("p",[a._v("3GB 是mapreduce.map.memory.db 乘以 yarn.nodemanager.vmem-pmem-ratio 得到的")]),a._v(" "),t("p",[a._v("其中yarn.nodemanager.vmem-pmem-ratio 是 虚拟内存和物理内存比例，在yarn-site.xml中设置，默认是2.1, 由于我本地设置的是3， 所以 1*3 = 3GB")]),a._v(" "),t("p",[a._v("很明显，container占用了4.9G的虚拟内存，但是分配给container的却只有3GB。所以kill掉了这个container")]),a._v(" "),t("p",[a._v("上面只是map中产生的报错，当然也有可能在reduce中报错，如果是reduce中，那么就是mapreduce.reduce.memory.db * yarn.nodemanager.vmem-pmem-ratio")]),a._v(" "),t("p",[a._v("解决办法\n主要是以下四个方面考虑")]),a._v(" "),t("p",[a._v("取消虚拟内存的检查：\n在yarn-site.xml或者程序中中设置yarn.nodemanager.vmem-check-enabled为false")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("yarn.nodemanager.vmem-check-enabled"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("false"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("Whether virtual memory limits will be enforced for containers."),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("p",[a._v("除了虚拟内存超了，也有可能是物理内存超了，同样也可以设置物理内存的检查为false： yarn.nodemanager.pmem-check-enabled\n个人认为这种办法并不太好，如果程序有内存泄漏等问题，取消这个检查，可能会导致集群崩溃。")]),a._v(" "),t("p",[a._v("增大mapreduce.map.memory.mb 或者 mapreduce.map.memory.mb\n个人觉得是一个办法，应该优先考虑这种办法，这种办法不仅仅可以解决虚拟内存，或许大多时候都是物理内存不够了，这个办法正好适用\n适当增大yarn.nodemanager.vmem-pmem-ratio的大小，一个物理内存增大多个虚拟内存， 但是这个参数也不能太离谱")]),a._v(" "),t("p",[a._v("如果任务所占用的内存太过离谱，更多考虑的应该是程序是否有内存泄漏，是否存在数据倾斜等，优先程序解决此类问题")]),a._v(" "),t("p",[a._v("参考链接"),t("a",{attrs:{href:"https://blog.csdn.net/T1DMzks/article/details/78818874",target:"_blank",rel:"noopener noreferrer"}},[a._v("运行mapreduce内存问题"),t("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);